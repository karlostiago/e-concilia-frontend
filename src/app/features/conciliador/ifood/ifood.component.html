<form autocomplete="off" class="fade-in">
    <div class="card">
        <div class="card-header">
            <h4 class="color-wine"> Conciliador ifood </h4>
        </div>

        <div class="card-body">
            <div class="row">
                <div class="col-md-12 mb-10">
                    <small class="float-end color-wine">Os campos com ( * ) são obrigatórios.</small>
                </div>
            </div>

            <div class="row">
                <div class="col-md-2">
                    <label class="form-label">Data da venda de*:</label>
                    <p-calendar appendTo="body" id="dtVendaDe" [style]="{ 'width': '100%' }" name="dtVendaDe" [readonlyInput]="true" dateFormat="dd/mm/yy" [(ngModel)]="dtVendaDe"></p-calendar>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Data da venda até*:</label>
                    <p-calendar appendTo="body" id="dtVendaAte" [style]="{ 'width': '100%' }" name="dtVendaAte" [readonlyInput]="true" dateFormat="dd/mm/yy" [(ngModel)]="dtVendaAte"></p-calendar>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <label class="form-label">Empresa*:</label>
                    <p-dropdown styleClass="w-100" name="empresa" id="empresa" optionLabel="razaoSocial" optionValue="id" [options]="empresas" placeholder="Selecione uma empresa"
                                [(ngModel)]="empresaId" [required]="true"></p-dropdown>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Método de pagamento:</label>
                    <p-dropdown styleClass="w-100" name="metodo" id="metodo" [options]="metodos" placeholder="Selecione um método" [(ngModel)]="metodoPagamento"></p-dropdown>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Bandeira:</label>
                    <p-dropdown styleClass="w-100" name="metodo" id="bandeira" [options]="bandeiras" placeholder="Selecione uma bandeira" [(ngModel)]="bandeira"></p-dropdown>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-10">
                    <br/>
                    <div class="card-action">
                        <button pButton class="p-button-danger p-button-sm" icon="pi pi-search"  (click)="pesquisar()" label="Pesquisar"></button>
                        <button pButton class="p-button-danger p-button-sm" icon="pi pi-eraser" label="Limpar" (click)="limpar()"></button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-10"></div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-10">
                    <p-table [value]="conciliador.vendas" [tableStyle]="{ 'min-width': '50rem' }" [paginator]="true" [rows]="10" styleClass="p-datatable-striped p-datatable p-datatable-gridlines" #tabela>
                        <ng-template pTemplate="header">
                            <tr>
                                <th class="text-center w-40" rowspan="2">Bandeira</th>
                                <th class="text-center w-15" rowspan="2">Tipo pagamento</th>
                                <th class="text-center w-5" rowspan="2">Método pagamento</th>
                                <th class="text-center w-5" rowspan="2">Valor pedido</th>
                                <th class="text-center w-5" rowspan="2">Taxa entrega</th>
                                <th class="text-center w-5" colspan="2">Taxa pagamento</th>
                                <th class="text-center w-5" colspan="2">Taxa comissão</th>
                                <th class="text-center w-5" rowspan="2">Diferença</th>
                                <th class="text-center w-10" rowspan="2">Conciliado</th>
                            </tr>
                            <tr>
                                <th class="text-center">Praticada</th>
                                <th class="text-center">Aplicada</th>
                                <th class="text-center">Praticada</th>
                                <th class="text-center">Aplicada</th>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-venda>
                            <tr>
                                <td class="text-center"> {{ venda["pagamento"]["bandeira"] }} </td>
                                <td class="text-center"> {{ venda["pagamento"]["tipo"] }} </td>
                                <td class="text-center"> {{ venda["pagamento"]["metodo"] }} </td>
                                <td class="text-end"> {{ formatarValor(venda["cobranca"]["totalItensPedido"]) }} </td>
                                <td class="text-end"> {{ formatarValor(venda["cobranca"]["taxaEntrega"]) }} </td>
                                <td class="text-end"> {{ formatarValor(Math.abs(venda["cobranca"]["taxaAdquirente"])) }} </td>
                                <td class="text-end"> {{ formatarValor(venda["cobranca"]["taxaAdquirenteAplicada"]) }} </td>
                                <td class="text-end"> R$ 0,00 </td>
                                <td class="text-end"> R$ 0,00 </td>
                                <td class="text-end"> {{ formatarValor(venda["diferenca"]) }} </td>
                                <td class="text-center">
                                    <span class=" {{ venda['conciliado'] === true ? 'badge text-bg-success' : 'badge text-bg-danger' }} ">
                                    {{ venda["conciliado"] === true ? 'Sim' : 'Não' }}
                                    </span>
                                </td>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="footer">
                            <tr>
                                <td colspan="3" class="text-end">Total de vendas do período</td>
                                <td class="text-end"> {{ formatarValor(conciliador.totalizador.totalValorPedido) }}</td>
                                <td class="text-end"> {{ formatarValor(conciliador.totalizador.totalTaxaEntrega) }}</td>
                                <td class="text-end"> {{ formatarValor(conciliador.totalizador.totalTaxaAquisicaoPraticada) }}</td>
                                <td class="text-end"> {{ formatarValor(conciliador.totalizador.totalTaxaAquisicaoAplicada) }}</td>
                                <td></td>
                                <td></td>
                                <td class="text-end"> {{ formatarValor(conciliador.totalizador.totalDiferenca) }}</td>
                                <td></td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-10"></div>
            </div>

            <app-resumo-financeiro [resumoFinanceiro]="conciliador.resumoFinanceiro"></app-resumo-financeiro>
        </div>
    </div>
</form>
